# üöÄ –ü–ª–∞–Ω –°–ª–µ–¥—É—é—â–µ–≥–æ –°–ø—Ä–∏–Ω—Ç–∞ - –≠—Ç–∞–ø 2: –§–∞–π–ª–æ–≤–æ–µ –•—Ä–∞–Ω–∏–ª–∏—â–µ

## üéØ **–¶–ï–õ–¨ –°–ü–†–ò–ù–¢–ê**
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –¥–æ–∫—Ç—Ä–∏–Ω—É —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å —É—Å–ª–æ–≤–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

## üß† **–ù–û–í–ê–Ø –î–û–ö–¢–†–ò–ù–ê –§–ê–ô–õ–û–í–û–ì–û –•–†–ê–ù–ò–õ–ò–©–ê**

### **–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**

1. **üìÅ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è** ‚Üí —Å—Ä–∞–∑—É –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
2. **üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** (–≤–æ–∑–º–æ–∂–Ω–æ `public/storage/`) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ —Ö–æ–¥–µ –ø–µ—Ä–µ–ø–∏—Å–∫–∏
3. **‚ùå –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ** - –µ—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è, —Ñ–∞–π–ª —Å—Ç–∏—Ä–∞–µ—Ç—Å—è –∏ –¥–∞–Ω–Ω—ã–µ –æ –Ω—ë–º —Ç–æ–∂–µ
4. **‚úÖ –£—Å–ª–æ–≤–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –µ—Å–ª–∏ —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–∫–∞—á–∞–ª—Å—è –∏ —ç–º–±–µ–¥–¥–∏–Ω–≥ –ø—Ä–æ—à—ë–ª —É—Å–ø–µ—à–Ω–æ, —Ç–æ —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–æ–≤–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
5. **üîê –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** - —Ö–µ—à —Ñ–∞–π–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–∑–µ –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
6. **üìä –ú–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–∑–µ

---

## üìã **–ó–ê–î–ê–ß–ò –°–ü–†–ò–ù–¢–ê**

### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**
- [ ] **–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è** - `public/storage/` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–∞–ø–∫—É
- [ ] **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—É—Ç–∏ –¥–æ—Å—Ç—É–ø–∞** - URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º  
- [ ] **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API —Å–∫–∞—á–∏–≤–∞–Ω–∏—è** - endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –ø–æ ID/—Ö–µ—à—É
- [ ] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å upload API** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ

### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è**
- [ ] **–û–±–Ω–æ–≤–∏—Ç—å upload workflow** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ + —ç–º–±–µ–¥–¥–∏–Ω–≥–∞
- [ ] **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–∫–∞—Ç** - —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ—à–∏–±–∫–µ –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ
- [ ] **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å** - atomic –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] **Error handling** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –æ—à–∏–±–æ–∫

### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ú–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**
- [ ] **–û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –ë–î** - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –¥–ª—è –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- [ ] **–£–ª—É—á—à–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ö–µ—à–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- [ ] **–•—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã—Ö** - —Ä–∞–∑–º–µ—Ä, —Ç–∏–ø, –ø—É—Ç—å, –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏
- [ ] **API –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã—Ö** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö

### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: UX —É–ª—É—á—à–µ–Ω–∏—è**  
- [ ] **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏** - –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞
- [ ] **–°—Å—ã–ª–∫–∏ –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ** - –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —á–∞—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã
- [ ] **–ò—Å—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∑–æ–∫** - —Å–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- [ ] **–ü—Ä–µ–≤—å—é —Ñ–∞–π–ª–æ–≤** - –ø–æ–∫–∞–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ TXT

---

## üéØ **FLOW –ù–û–í–û–ô –°–ò–°–¢–ï–ú–´**

```
üìÅ Upload File
    ‚Üì
üîê Calculate Hash 
    ‚Üì 
‚ùì Check if exists in DB
    ‚Üì (if not exists)
üîÑ Parse to TXT format
    ‚Üì
üîó Create Embeddings  
    ‚Üì
‚úÖ Both successful?
    ‚Üì YES                    ‚ùå NO
üíæ Save to File Storage      üóëÔ∏è Delete file & data
    ‚Üì                           ‚Üì 
üìä Save meta to DB           ‚ùå Return error
    ‚Üì
üéâ Return success with download link
```

---

## üîß **–¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò**

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:**
```
public/storage/
‚îú‚îÄ‚îÄ 2025/
‚îÇ   ‚îú‚îÄ‚îÄ 01/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ [hash].txt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [hash].txt
‚îÇ   ‚îî‚îÄ‚îÄ 02/
‚îî‚îÄ‚îÄ metadata.json (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### **–ù–æ–≤—ã–µ API endpoints:**
- `GET /api/files/[hash]` - —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –ø–æ —Ö–µ—à—É
- `GET /api/files/list` - —Å–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤  
- `GET /api/files/[hash]/meta` - –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞
- `DELETE /api/files/[hash]` - —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª (admin)

### **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã –ë–î:**
```sql
ALTER TABLE files ADD COLUMN storage_path TEXT;
ALTER TABLE files ADD COLUMN download_url TEXT;  
ALTER TABLE files ADD COLUMN is_accessible BOOLEAN DEFAULT false;
```

---

## ‚ö° **–ö–†–ò–¢–ï–†–ò–ò –ó–ê–í–ï–†–®–ï–ù–ò–Ø –°–ü–†–ò–ù–¢–ê**

### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ (MVP):**
- [x] –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ
- [x] –§–∞–π–ª—ã —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞/—ç–º–±–µ–¥–¥–∏–Ω–≥–∞  
- [x] –†–∞–±–æ—Ç–∞–µ—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ —Ö–µ—à—É
- [x] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TXT —Ñ–∞–π–ª

### **–ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (Nice to have):**
- [x] –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- [x] –í —á–∞—Ç–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
- [x] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

---

## üîÑ **–ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò**

### **–î–µ–Ω—å 1**: –§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞–ø–∫—É –∏ –ø—É—Ç–∏
- –°–æ–∑–¥–∞—Ç—å API —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å upload workflow

### **–î–µ–Ω—å 2**: –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –û–±–Ω–æ–≤–∏—Ç—å upload API
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç–∏

### **–î–µ–Ω—å 3**: –ú–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ –∏ UX
- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –ë–î
- –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —Ñ–∞–π–ª–æ–≤

---

## üö® **–í–ê–ñ–ù–´–ï –ú–û–ú–ï–ù–¢–´**

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Ñ–∞–π–ª—ã –≤ `public/` –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º, –Ω—É–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å —Å–µ—Ä–≤–µ—Ä  
3. **–î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ** - –Ω—É–∂–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞
4. **Backup** - —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω–æ –≤ –±–µ–∫–∞–ø—ã

---

*–ü–ª–∞–Ω —Å–æ–∑–¥–∞–Ω: 01.08.2025*  
*–û—Å–Ω–æ–≤–∞–Ω –Ω–∞ –Ω–æ–≤–æ–π –¥–æ–∫—Ç—Ä–∏–Ω–µ —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞*
