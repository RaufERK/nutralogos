### Итоговая оценка готовности

- **Статус**: 6/10 — крепкий MVP, есть блокеры для продакшена.

### Критические блокеры
- **Хранилище файлов**: сейчас локально (`uploads/...`). Для продакшена нужен S3/R2/MinIO с presigned upload.
- **База данных**: SQLite-файл в ФС. Нужна управляемая БД или надёжный volume + бэкапы/миграции.
- **Rate limiting**: отсутствует для `/api/ask`, `/api/upload`, логина.
- **Безопасность HTTP**: нет CSP/secure headers/CORS-политики.
- **Валидация env**: нет fail-fast проверки критичных переменных.

### Что сделано сегодня
- **Middleware (защита API и админки) — исправлено**:
  - Разрешены preflight-запросы `OPTIONS` для API.
  - В список защищённых добавлены `'/api/upload*'`.
  - Неавторизованным запросам к защищённым API возвращается `401` JSON.
  - Для админ-страниц без роли `admin` — редирект на `'/admin/login'`.
  - `matcher` остаётся: `'/admin/:path*'`, `'/api/:path*'`.

### Следующие шаги (по приоритету)
1) Ввести rate limiting (IP/пользователь) для `/api/ask`, логина, загрузок.
2) Перенести файлы в S3-совместимое хранилище (presigned PUT), оставить локальный режим для dev.
3) Перенести БД на управляемое решение или закрепить volume, настроить бэкапы.
4) Добавить security headers (CSP, X-Frame-Options, X-Content-Type-Options, Referrer-Policy) и строгий CORS.
5) Валидация env на старте и безопасные дефолты для моделей/лимитов.
